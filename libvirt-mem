#!/usr/bin/env bash
v(){ virsh -c "$c" "${@}";};e(){ echo "${@}";};u(){ e "usage: $0 [<URI>]">&2;exit 1;};(($#-1))||c="$1"&&{ !(($#-2))&&u;};p='RAM';c="${c:-""}";g(){ grep "${@}";};s(){ { t=1;s=$((t-1));r=$((t**s-t));l='|%10d%s |%10d%s';q=name;while read m v z;do ((t))&&e "$q|$y $p|current $p"&&{ l 1;((t--));};printf "%s:$l\n" $v $m $k $z $k;s=$((m+s));r=$((z+r));done;l;printf "\ntotal:$l" $s $k $r $k ;}|column -ts'|' -o '| ';};y=maximum;l(){ for x in $(seq 3 -1 1);do for a in $(seq 15);do e -n -;done;((--x))&&e -n '|';done;[[ "$1" ]]&&e -e '\n';};k=KiB;for h in $(v list --name);do o="$(v dumpxml $h|g -e currentMemory -e memory)";i=$(e "$o"|head -1|g -oP '\d+');e "$o"|head -2|tail -1|g -oP '\d+'|cat <(e $i) <(e $h) -|tr '\n' ' '|cat - <(e -e '\n');done|sort -u|comm -23 - <(e -e '\n')|s
